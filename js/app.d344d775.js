(function(){"use strict";var e={3044:function(e,t,s){var n=s(9242),a=s(3396),i=s(7139);const o=e=>((0,a.dD)("data-v-62c280cd"),e=e(),(0,a.Cn)(),e),r={class:"telegram-mini-app"},l={class:"profile"},u=o((()=>(0,a._)("h2",null,"Профиль пользователя",-1)));function h(e,t,s,n,o,h){const d=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("div",l,[u,(0,a._)("p",null,"Здравствуйте, "+(0,i.zw)(`${h.userData?.first_name} ${h.userData?.last_name}`),1),(0,a._)("p",null,(0,i.zw)(`@${h.userData?.username}`),1)]),(0,a.Wm)(d)])}s(560);function d(e,t,s,n,o,r){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("p",null,"Ширина экрана: "+(0,i.zw)(o.screenWidth)+"px",1),(0,a._)("p",null,"Высота экрана: "+(0,i.zw)(o.screenHeight)+"px",1)])}var g={data(){return{screenWidth:0,screenHeight:0}},mounted(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)},unmounted(){window.removeEventListener("resize",this.updateDimensions)},methods:{updateDimensions(){this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}}},c=s(89);const p=(0,c.Z)(g,[["render",d],["__scopeId","data-v-2d1c2953"]]);var m=p,_={name:"TelegramMiniApp",data(){return{telegramWebAppData:null,title:"Telegram Mini App",requestText:"",buttonDisabled:!1,response:[],responseKey:0}},components:{HelloTest:m},computed:{axios(){return this.$store.getters.getAxios},userTgData(){return this.$store.getters.getUserTgData},userData(){return this.$store.getters.getUserData}},mounted(){this.getTgData(),this.login()},methods:{getTgData(){if(window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData);else{const e=this.stringToObject('query_id=AAEdq3R2AAAAAB2rdHb-RVel&user={"id":1987357469,"first_name":"Dmitriy","last_name":"Alexandrov","username":"ditritus_h","language_code":"ru","allows_write_to_pm":true}&auth_date=1703739367&hash=4c71272061cb0c6abb6832d9167b1d8a6f846a44e02177d819cc442e990aba1d}');this.updateUserTgData(e)}},getTzh(){let e=new Date,t=e.getTimezoneOffset(),s=t/60;return-s},async login(){const e=await this.axios.post("/authorize",{telegram_id:this.userTgData?.user.id,first_name:`${this.userTgData?.user.first_name}`,last_name:`${this.userTgData?.user.last_name}`,username:`${this.userTgData?.user.username}`,tzh:this.getTzh()});200===e.status&&(this.updateUserData(e.data.data),this.refreshChannels())},async refreshChannels(){console.log("wer");const e=this.userData?.id;if(void 0===e)return void this.$router.push("/");const t=await this.axios.get(`/channels/${this.userData?.id}`);200===t.status&&this.updateUserChannels(t.data.data)},updateUserTgData(e){this.$store.commit("setUserTgData",e)},updateUserData(e){this.$store.commit("setUserData",e)},updateUserChannels(e){this.$store.commit("setUserChannels",e)},stringToObject(e){e=decodeURIComponent(e);const t=e.split("&"),s={};return t.forEach((e=>{const[t,n]=e.split("=");s[t]="user"===t?JSON.parse(decodeURIComponent(n)):decodeURIComponent(n)})),s}}};const C=(0,c.Z)(_,[["render",h],["__scopeId","data-v-62c280cd"]]);var f=C,w=s(1076);const v=w.Z.create({baseURL:"http://localhost:3000"});var y=v,b=s(65),T=s(2415);const D=(0,b.MT)({state(){return{axios:y,userTgData:{},userData:{},userChannels:[],curChannel:{},modals:{createChannel:{isShow:!1,channel_name:null,channel_id:null,config:null}}}},mutations:{setUserTgData(e,t){console.log("update userTgData",t),e.userTgData=t},setUserData(e,t){console.log("update userdata",t),e.userData=t},setUserChannels(e,t){console.log("update userChannels",t),e.userChannels=t},setCurChannel(e,t){console.log("update setCurChannel",t),e.curChannel=t},setCreateChannelModal(e,t){console.log("update:modal createChannelModal",t),e.modals.createChannel=t}},actions:{},getters:{getUserTgData:e=>e.userTgData,getUserData:e=>e.userData,getUserChannels:e=>e.userChannels,getCurChannel:e=>{const t=JSON.parse(JSON.stringify(e.curChannel));return t.config&&t.config.postTimes&&(t.config.postTimes=t.config.postTimes.map((e=>U(e)))),t},getCreateChannelModal:e=>e.modals.createChannel,getAxios:e=>e.axios}});function U(e){let[t,s]=e.split(":");return"12"==t?t="00":"00"==t&&(t="12"),`${t.toString().padStart(2,"0")}:${s}`}const x={key:"my-vuex-state",storage:window.localStorage};(0,T.Z)(x)(D);var $=D,k=s(2483);const A=e=>((0,a.dD)("data-v-0ad9aece"),e=e(),(0,a.Cn)(),e),M={class:"ChannelsComp"},I=A((()=>(0,a._)("h3",null,"Ваши каналы",-1))),S={class:"channels-buttons"},O={class:"channel-list"},V={class:"channel-name"},N={key:0,class:"error-reason"};function H(e,t,s,n,o,r){const l=(0,a.up)("CreateChannelModal"),u=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",M,[r.createChannelModal?.isShow?((0,a.wg)(),(0,a.j4)(l,{key:0,name:"modal"})):(0,a.kq)("",!0),I,(0,a._)("div",S,[(0,a._)("span",null,[(0,a._)("button",{onClick:t[0]||(t[0]=e=>r.updateChannels())},"Обновить")]),(0,a._)("span",null,[(0,a._)("button",{onClick:t[1]||(t[1]=(...e)=>r.showCreateChannelModal&&r.showCreateChannelModal(...e))},"Создать")])]),(0,a._)("div",O,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.userChannels,(e=>((0,a.wg)(),(0,a.j4)(u,{style:(0,i.j5)({background:r.getColorBackground(e.status)}),class:"channel",to:"/channel",onClick:t=>r.setCurChannel(e.id,e.user_id),key:e.id},{default:(0,a.w5)((()=>[(0,a._)("div",V," Канал: "+(0,i.zw)(e.channel_name),1),"HEALTHY"!==e.status?((0,a.wg)(),(0,a.iD)("div",N," Ошибка: "+(0,i.zw)(r.getReasonText(e.reason)),1)):(0,a.kq)("",!0)])),_:2},1032,["style","onClick"])))),128))])])}const R=e=>((0,a.dD)("data-v-dbf0e730"),e=e(),(0,a.Cn)(),e),z={class:"modal-mask"},L={class:"modal-wrapper"},W={class:"modal-container"},j={class:"modal-header"},G={class:"modal-body"},P=R((()=>(0,a._)("label",null,[(0,a._)("span",{class:"question-mark",title:"Узнайте ID канала, перекинув ссылку на канал боту @username_to_id_bot"},"?")],-1))),E={class:"modal-footer"};function Z(e,t,s,i,o,r){return(0,a.wg)(),(0,a.j4)(n.uT,{name:"modal"},{default:(0,a.w5)((()=>[(0,a._)("div",z,[(0,a._)("div",L,[(0,a._)("div",W,[(0,a._)("div",j,[(0,a.Uk)(" Добавление канала "),(0,a.WI)(e.$slots,"header",{},(()=>[(0,a._)("button",{class:"modal-close-button",onClick:t[0]||(t[0]=(...e)=>r.close&&r.close(...e))}," Close ")]),!0)]),(0,a._)("div",G,[(0,a.WI)(e.$slots,"body",{},(()=>[(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.channel_name=e),placeholder:"@your_channel"},null,512),[[n.nr,o.channel_name]]),(0,a._)("div",null,[(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.channel_id=e),placeholder:"Айди канала"},null,512),[[n.nr,o.channel_id]]),P])]),!0)]),(0,a._)("div",E,[(0,a.WI)(e.$slots,"footer",{},(()=>[(0,a.Uk)(" default footer "),(0,a._)("button",{onClick:t[3]||(t[3]=(...e)=>r.submit&&r.submit(...e))},"Создать")]),!0)])])])])])),_:3})}var q={data(){return{channel_name:"",channel_id:""}},computed:{axios(){return this.$store.getters.getAxios},userData(){return this.$store.getters.getUserData},createChannelModal(){return this.$store.getters.getCreateChannelModal}},methods:{close(){this.updateCreateChannelModal({...this.createChannelModal,isShow:!1})},async submit(){const e=await this.axios.post("/channel",{channel_name:this.channel_name,channel_id:this.channel_id,user_id:this.userData.id});200===e.status&&await this.refreshChannels(),this.close()},async refreshChannels(){const e=await this.axios.get(`/channels/${this.userData.id}`);200===e.status&&this.updateUserChannels(e.data.data)},updateUserChannels(e){this.$store.commit("setUserChannels",e)},updateCreateChannelModal(e){this.$store.commit("setCreateChannelModal",e)}}};const F=(0,c.Z)(q,[["render",Z],["__scopeId","data-v-dbf0e730"]]);var Y=F,B={name:"ChannelsComp",data(){return{showModal:!1}},components:{CreateChannelModal:Y},computed:{axios(){return this.$store.getters.getAxios},userData(){return this.$store.getters.getUserData},createChannelModal(){return this.$store.getters.getCreateChannelModal},userChannels(){const e=this.$store.getters.getUserChannels;return e.sort(((e,t)=>"CRITICAL"===e.status&&"CRITICAL"!==t.status?-1:"CRITICAL"!==e.status&&"CRITICAL"===t.status?1:"WARNING"===e.status&&"WARNING"!==t.status?-1:"WARNING"!==e.status&&"WARNING"===t.status?1:0))}},methods:{getColorBackground(e){switch(e){case"HEALTHY":return"green";case"WARNING":return"yellow";case"CRITICAL":return"red"}},getReasonText(e){switch(e){case"CANT_SEND_POSTS":return"У бота отсутствуют права на создание постов.";case"CHANNEL_NOT_FOUND":return"Канал не найден."}},showCreateChannelModal(){this.updateCreateChannelModal({...this.createChannelModal,isShow:!0})},setCurChannel(e,t){this.getCurChannel(t,e)},async getCurChannel(e,t){const s=await this.axios.get(`/user/${e}/channel/${t}`);200===s.status&&this.updateCurChannel(s.data.data)},async updateChannels(){console.log("tes");const e=await this.axios.get(`/channels/${this.userData?.id}`);200===e.status&&this.updateUserChannels(e.data.data)},updateCurChannel(e){this.$store.commit("setCurChannel",e)},updateCreateChannelModal(e){this.$store.commit("setCreateChannelModal",e)},updateUserChannels(e){this.$store.commit("setUserChannels",e)}}};const J=(0,c.Z)(B,[["render",H],["__scopeId","data-v-0ad9aece"]]);var K=J;const Q={class:"status"},X={class:"settings"},ee={class:"settings-theme"},te={class:"settings-symbols"},se={class:"settings-expression"},ne={class:"settings-orig"},ae={class:"settings_expert"},ie=(0,a._)("div",null,"Экспертность:",-1),oe={class:"settings-gender"},re=(0,a._)("label",{for:"male"},"Мужчина",-1),le=(0,a._)("label",{for:"female"},"Женщина",-1),ue={class:"settings-smiles"},he={class:"settings-slang"},de=(0,a._)("div",null,"Сленг:",-1),ge=(0,a._)("label",{for:"young"},"Молодежный",-1),ce=(0,a._)("label",{for:"expert"},"Эксперта",-1),pe=(0,a._)("label",{for:"science"},"Научный",-1),me=(0,a._)("label",{for:"modern"},"Современный",-1),_e=(0,a._)("label",{for:"girl"},"Девочки",-1),Ce=(0,a._)("label",{for:"malee"},"Мужчины",-1),fe=(0,a._)("label",{for:"postCount"},"Количество постов:",-1),we=["for"],ve=["id","onUpdate:modelValue","onChange"],ye=["disabled"];function be(e,t,s,o,r,l){const u=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(u,{to:"/"},{default:(0,a.w5)((()=>[(0,a.Uk)("Назад")])),_:1}),(0,a._)("h2",null,"Канал "+(0,i.zw)(l.сurChannel.channel_name),1),(0,a._)("div",Q,[(0,a._)("h3",null,"Состояние: "+(0,i.zw)("HEALTHY"==l.сurChannel.status?"Рабочий":`Есть неисправность: ${l.сurChannel.status}:${l.сurChannel.reason}`),1)]),(0,a._)("button",{onClick:t[0]||(t[0]=e=>l.fastPost())},"Сделать быстрый пост"),(0,a._)("button",{onClick:t[1]||(t[1]=e=>r.showSettings=!r.showSettings)},"Открыть настройки канала"),(0,a.wy)((0,a._)("div",X,[(0,a._)("div",ee,[(0,a.Uk)(" Тематика: "),(0,a.wy)((0,a._)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.settings_theme=e),placeholder:"Одним - двумя словами про тематику канала"},null,512),[[n.nr,r.settings_theme]])]),(0,a._)("div",te,[(0,a.Uk)(" Количество символов: "),(0,a.wy)((0,a._)("input",{type:"number",min:"0","onUpdate:modelValue":t[3]||(t[3]=e=>r.settings_symbols=e),placeholder:"Сколько в среднем будет символов в посте"},null,512),[[n.nr,r.settings_symbols]])]),(0,a._)("div",se,[(0,a.Uk)(" Экспрессия: "),(0,a.wy)((0,a._)("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":t[4]||(t[4]=e=>r.settings_expression=e)},null,512),[[n.nr,r.settings_expression]])]),(0,a._)("div",ne,[(0,a.Uk)(" Оригинальность: "),(0,a.wy)((0,a._)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>r.settings_orig=e)},null,512),[[n.e8,r.settings_orig]])]),(0,a._)("div",ae,[ie,(0,a.wy)((0,a._)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>r.settings_expert=e),placeholder:"Например: Представь, что ты таролог с двадцатилетним стажем и обладаешь всеми знаниями, опытом и знаешь даже самые неочевидные лайфхаки."},null,512),[[n.nr,r.settings_expert]])]),(0,a._)("div",oe,[(0,a.wy)((0,a._)("input",{type:"radio",id:"male",value:"male","onUpdate:modelValue":t[7]||(t[7]=e=>r.settings_gender=e)},null,512),[[n.G2,r.settings_gender]]),re,(0,a.wy)((0,a._)("input",{type:"radio",id:"female",value:"female","onUpdate:modelValue":t[8]||(t[8]=e=>r.settings_gender=e)},null,512),[[n.G2,r.settings_gender]]),le]),(0,a._)("div",ue,[(0,a.Uk)(" Смайлики: "),(0,a.wy)((0,a._)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>r.settings_smiles=e)},null,512),[[n.e8,r.settings_smiles]])]),(0,a._)("div",he,[de,(0,a.wy)((0,a._)("input",{type:"radio",id:"young",value:"young","onUpdate:modelValue":t[10]||(t[10]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),ge,(0,a.wy)((0,a._)("input",{type:"radio",id:"expert",value:"expert","onUpdate:modelValue":t[11]||(t[11]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),ce,(0,a.wy)((0,a._)("input",{type:"radio",id:"science",value:"science","onUpdate:modelValue":t[12]||(t[12]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),pe,(0,a.wy)((0,a._)("input",{type:"radio",id:"modern",value:"modern","onUpdate:modelValue":t[13]||(t[13]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),me,(0,a.wy)((0,a._)("input",{type:"radio",id:"girl",value:"girl","onUpdate:modelValue":t[14]||(t[14]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),_e,(0,a.wy)((0,a._)("input",{type:"radio",id:"malee",value:"male","onUpdate:modelValue":t[15]||(t[15]=e=>r.settings_slang=e)},null,512),[[n.G2,r.settings_slang]]),Ce]),(0,a._)("div",null,[fe,(0,a.wy)((0,a._)("input",{type:"number",id:"postCount","onUpdate:modelValue":t[16]||(t[16]=e=>r.postCount=e),min:"1",onChange:t[17]||(t[17]=()=>l.updatePostTimes())},null,544),[[n.nr,r.postCount]]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.postTimes,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a._)("label",{for:"postTime_"+t},"Время для поста "+(0,i.zw)(t+1)+":",9,we),(0,a.wy)((0,a._)("input",{type:"time",value:"22:00",id:"postTime_"+t,"onUpdate:modelValue":e=>r.postTimes[t]=e,onChange:e=>l.updatePostTimes(e,t)},null,40,ve),[[n.nr,r.postTimes[t]]])])))),128))]),(0,a._)("button",{disabled:r.isLoading,onClick:t[18]||(t[18]=(...e)=>l.handleSave&&l.handleSave(...e))},(0,i.zw)(r.isLoading?"Загрузка...":"Сохранить"),9,ye)],512),[[n.F8,r.showSettings]])])}var Te={data(){return{isLoading:!1,showSettings:!1,postCount:1,postTimes:["00:00"],settings_theme:"",settings_symbols:"",settings_expression:"",settings_orig:!1,settings_expert:"",settings_gender:"",settings_smiles:!1,settings_slang:""}},mounted(){this.init()},computed:{axios(){return this.$store.getters.getAxios},"сurChannel"(){return console.log("return cur channel",this.$store.getters.getCurChannel),this.$store.getters.getCurChannel},userData(){return this.$store.getters.getUserData}},watch:{"сurChannel"(e,t){this.postInit(e)}},methods:{async fastPost(){await this.axios.post("/post",{channel_id:this.сurChannel.id,time:new Date})},init(){this.settings_theme=this.сurChannel.config?.theme||"",this.settings_symbols=this.сurChannel.config?.symbols||"",this.settings_expression=this.сurChannel.config?.expression||"",this.settings_orig=this.сurChannel.config?.orig||!1,this.settings_expert=this.сurChannel.config?.expert||"",this.settings_gender=this.сurChannel.config?.gender||"",this.settings_smiles=this.сurChannel.config?.smiles||!1,this.settings_slang=this.сurChannel.config?.slang||"",this.postCount=this.сurChannel.config?.postTimes?.length||1,this.postTimes=this.сurChannel.config?.postTimes||["12:00"]},postInit(e){this.settings_theme=e.config.theme||"",this.settings_symbols=e.config.symbols||"",this.settings_expression=e.config.expression||"",this.settings_orig=e.config.orig||!1,this.settings_expert=e.config.expert||"",this.settings_gender=e.config.gender||"",this.settings_smiles=e.config.smiles||!1,this.settings_slang=e.config.slang||"",this.postCount=e.config.postTimes?.length||1,this.postTimes=e.config.postTimes||["12:00"]},updatePostTimes(e,t){if(!Number.isInteger(t)){while(this.postTimes.length<this.postCount)this.postTimes.push("00:00");this.postTimes.length>this.postCount&&(this.postTimes=this.postTimes.slice(0,this.postCount))}},convertTo24HourFormat(e){let[t,s]=e.split(":");return"12"==t?t="00":"00"==t&&(t="12"),`${t.toString().padStart(2,"0")}:${s}`},convertToData(e){let[t,s]=e.split(":");const n=new Date;return n.setSeconds(0),n.setMilliseconds(0),n.setHours(t),n.setMinutes(s),n.getTime()},async handleSave(){this.isLoading=!0;let e=this.postTimes.map((e=>this.convertTo24HourFormat(e)));const t={...this.сurChannel,config:{theme:this.settings_theme,symbols:this.settings_symbols,expression:this.settings_expression,orig:this.settings_orig,expert:this.settings_expert,gender:this.settings_gender,smiles:this.settings_smiles,slang:this.settings_slang,postTimes:e}},s=await this.axios.patch(`/user/${this.userData.id}/channel/${this.сurChannel.id}`,t);200===s.status&&this.updateCurChannel(s.data.data),this.isLoading=!1},updateUserData(e){this.$store.commit("setUserData",e)},updateCurChannel(e){this.$store.commit("setCurChannel",e)}}};const De=(0,c.Z)(Te,[["render",be]]);var Ue=De;const xe=[{path:"/",name:"ChannelsComp",component:K},{path:"/channel",name:"CurChannelView",component:Ue}],$e=(0,k.p7)({history:(0,k.PO)("/telegram_autopost_twa/"),routes:xe});var ke=$e;const Ae=(0,n.ri)(f);Ae.use(ke),Ae.use($),Ae.mount("#app")}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,n,a,i){if(!n){var o=1/0;for(h=0;h<e.length;h++){n=e[h][0],a=e[h][1],i=e[h][2];for(var r=!0,l=0;l<n.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](n[l])}))?n.splice(l--,1):(r=!1,i<o&&(o=i));if(r){e.splice(h--,1);var u=a();void 0!==u&&(t=u)}}return t}i=i||0;for(var h=e.length;h>0&&e[h-1][2]>i;h--)e[h]=e[h-1];e[h]=[n,a,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,i,o=n[0],r=n[1],l=n[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(l)var h=l(s)}for(t&&t(n);u<o.length;u++)i=o[u],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(h)},n=self["webpackChunktelegram_mini_app"]=self["webpackChunktelegram_mini_app"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(3044)}));n=s.O(n)})();
//# sourceMappingURL=app.d344d775.js.map